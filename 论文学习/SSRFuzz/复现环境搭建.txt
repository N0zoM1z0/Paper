git clone https://github.com/SSRFuzz/SSRFuzz.git
cd SSRFuzz
git submodule update --init --progress

docker network create ssrf-net
docker pull dockerproxy.net/rocm/dev-ubuntu-22.04:latest
docker tag dockerproxy.net/rocm/dev-ubuntu-22.04:latest rocm/dev-ubuntu-22.04:latest
docker rmi dockerproxy.net/rocm/dev-ubuntu-22.04:latest
docker run -d --name SSRFuzz-u22 --network ssrf-net -v "$(pwd)":/SSRFuzz --gpus all rocm/dev-ubuntu-22.04 sleep infinity
docker exec -it SSRFuzz-u22 /bin/bash

docker run --name ssrf_db --network ssrf-net -e MYSQL_ROOT_PASSWORD=123456 -d -p 3306:3306 mysql:8.0

cd SSRFuzz
apt update && apt install python3-pip python3-venv -y && apt update && apt install software-properties-common -y
add-apt-repository ppa:ondrej/php # æŒ‰ENTER
apt update && apt install php7.4 php7.4-cli php7.4-fpm php7.4-mysql php7.4-curl php7.4-mbstring php7.4-xml php7.4-zip php7.4-dev php7.4-pgsql -y 

curl -sS https://getcomposer.org/installer -o composer-setup.php
php7.4 composer-setup.php --install-dir=/usr/local/bin --filename=composer
rm composer-setup.php

cd TaintInfer ; composer install
cd ../Fuzzer; pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple

cd ../zmark;
phpize
./configure
make -j$(nproc)

apt update && apt-get install -y mysql-client
mysql -h ssrf_db -u root -p

CREATE DATABASE IF NOT EXISTS ssrf_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
USE ssrf_db;

CREATE TABLE `ssrf_info` (
  `id` int unsigned NOT NULL AUTO_INCREMENT,
  `param` varchar(255) DEFAULT NULL,
  `Av1` varchar(255) DEFAULT NULL,
  `Av2` varchar(255) DEFAULT NULL,
  `Bv1` varchar(255) DEFAULT NULL,
  `Bv2` varchar(255) DEFAULT NULL,
  `requests` mediumtext,
  `vulntype` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

CREATE TABLE `ssrf_vuln` (
  `id` int unsigned NOT NULL AUTO_INCREMENT,
  `vulnparam` varchar(255) DEFAULT NULL,
  `vulntype` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

CREATE TABLE `check_info` (
  `id` int unsigned NOT NULL AUTO_INCREMENT,
  `param` varchar(255) DEFAULT NULL,
  `vulnable` varchar(255) DEFAULT '0',
  `stack` mediumtext,
  `body` mediumtext,
  `url` mediumtext,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4;

ALTER USER 'root'@'%' IDENTIFIED WITH 'mysql_native_password' BY '123456';
FLUSH PRIVILEGES;
exit;

# soshite, modify the TaintInfer/src/Config.php to use the right path 
# and modify Fuzzer/fuzzer.php to correct the database settings
# open 4 terminal

# docker exec -it SSRFuzz-u22 /bin/bash
# 1.
cd /SSRFuzz/Fuzzer && python3 fuzzer.py
# 2.
cd /SSRFuzz/Fuzzer && python3 detector.py
# 3.
cd /SSRFuzz/TaintInfer/verify && ./run.sh
# 4.
curl "http://localhost:8000/params.php?url=1&nnn=2"